function n(){this.eventPushInterval=1e3*this.getRandomInterval(7,11),this.pageLoadedAt=new Date().getTime(),this.eventPool=[],this.lastEventTimestamp=0,this.evtEndpoint="https://analytics.makeup.global/evt",this.ud=!1,this.udType="",this.pvid=this.uuid(),this.buuid=this.bid(),this.NEXT_PAGE_PAYLOAD="makeupAnalyticsPayload";const t=this.getValue(this.NEXT_PAGE_PAYLOAD);if(this.removeItem(this.NEXT_PAGE_PAYLOAD),t){const e=JSON.parse(t);e.hasOwnProperty("evt")&&e.evt.length&&this._send(e)}}n.prototype.bid=function(){let t=this.getValue("u");return t||(t=this.uuid(),this.setValue("u",t)),t};n.prototype.getValue=function(t){return window.localStorage?localStorage.getItem(t):null};n.prototype.setValue=function(t,e){if(!window.localStorage)return null;localStorage.setItem(t,e)};n.prototype.removeItem=function(t){if(!window.localStorage)return null;localStorage.removeItem(t)};n.prototype.uuid=function(){let t=new Date().getTime(),e=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){let i=Math.random()*16;return t>0?(i=(t+i)%16|0,t=Math.floor(t/16)):(i=(e+i)%16|0,e=Math.floor(e/16)),(o==="x"?i:i&3|8).toString(16)})};n.prototype.getRandomInterval=function(t,e){return Math.random()*(e-t+1)+t};n.prototype.setUDType=function(t){this.udType=t};n.prototype.buildPayload=function(){const t=[];for(;this.eventPool.length;){const o=this.eventPool.pop();o.ud_type=this.udType,t.push(o)}const e={evt:t,bid:this.buuid,ts:Math.round(window.performance.now())};return this.getValue("debug")&&(e.d=this.getValue("debug")),e};n.prototype.getUserPseudoId=function(){return this.buuid};n.prototype.getSid=function(){return this.getValue("sid")||null};n.prototype.parseResponse=function(t){t.hasOwnProperty("sid")?this.setValue("sid",t.sid):this.removeItem("sid")};n.prototype._send=function(t){const e=new XMLHttpRequest;e.open("POST",this.evtEndpoint,!0),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.withCredentials=!0,e.responseType="json",e.onload=()=>{this.parseResponse(e.response)},e.send(JSON.stringify(t))};n.prototype.send=function(t){if(!(!t&&!this.ud)&&this.eventPool.length){const e=this.buildPayload();this._send(e)}};n.prototype.init=function(){setInterval(()=>{this.send()},this.eventPushInterval)};n.prototype.getUrlParam=function(t){return location.href.replaceAll("?","$").replaceAll("&","$").split("$").filter(function(e){return e.includes(t)}).map(function(e){return e.split("=")}).flat()[1]};n.prototype.eventScaffold=function(){let e=new Date().getTime();return e<=this.lastEventTimestamp&&(e=this.lastEventTimestamp+2),this.lastEventTimestamp=e,{event_timestamp:e,ts:Math.round(window.performance.now()),event_name:"",event_params:{},client_id:"",site_language:document.documentElement.lang,page_loaded_at:this.pageLoadedAt,page_location:document.location.href,page_title:document.title,page_referrer:document.referrer,utm_source:this.getUrlParam("utm_source")??"",utm_medium:this.getUrlParam("utm_medium")??"",utm_campaign:this.getUrlParam("utm_campaign")??"",utm_content:this.getUrlParam("utm_content")??"",gclid:this.getUrlParam("gclid")??"",term:"",test_group:"",screen_width:window.innerWidth,screen_height:window.innerHeight,time_zone_offset_seconds:new Date().getTimezoneOffset(),hostname:document.location.hostname}};n.prototype.push=function(t,e){const o=this.eventScaffold();o.event_name=t,o.event_params=e,this.eventPool.push(o),["add_to_cart","page_view"].includes(t)&&this.send(),t==="purchase"&&this.send(!0)};n.prototype.saveForNextPage=function(){this.eventPool.length&&this.setValue(this.NEXT_PAGE_PAYLOAD,JSON.stringify(this.buildPayload()))};const s=new n;s.init();window["webAnalytics"]=s;window.addEventListener("load",function(){this.ud=!1,setTimeout(function(){s.push("page_view",{})},5e3)});window.addEventListener("beforeunload",function(){s.saveForNextPage()});["mousedown","keypress","scroll","touchstart"].forEach(function(t){document.addEventListener(t,function(e){s.ud=!0,s.setUDType(e.type)},{once:!0})});
